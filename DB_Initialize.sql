---REGIONCODES

SET SERVEROUTPUT ON;
DECLARE
nCount NUMBER;
--nCount1 NUMBER;
BEGIN
SELECT count(*) into nCount FROM user_tables where table_name = 'REGIONCODES';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('REGIONCODES TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE REGIONCODES(
REGCD varchar(10) PRIMARY KEY ,
DES varchar(20) NOT NULL,
TIMEZONE varchar(10),
CONSTRAINT check_tmzone CHECK 
(TIMEZONE IN (''EST'',''IST'',''PST'',''GMT'',''CST'',''SST'')))';

EXECUTE IMMEDIATE 'INSERT INTO REGIONCODES VALUES(''R001'',''NorthAmerica_Est'',''EST'')';
EXECUTE IMMEDIATE 'INSERT INTO REGIONCODES VALUES(''R002'',''NorthAmerica_Pst'',''PST'')';
EXECUTE IMMEDIATE 'INSERT INTO REGIONCODES VALUES(''R003'',''Singapore_Sst'',''SST'')';



END IF;


---ADDRESS


SELECT count(*) into nCount FROM user_tables where table_name = 'ADDRESS';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('ADDRESS TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE ADDRESS(
    ADDR_CODE varchar(10) PRIMARY KEY,
    ADDR_COUNTRYNAME varchar(50) NOT NULL,
    ADDR_PROVINCE varchar2(50) NOT NULL,
    CONSTRAINT REGCD
    REGIONCODE varchar(10) REFERENCES REGIONCODES(REGCD))';
    
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A01'',''United States of America'',''Massachusetts'',''R001'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A02'',''United States of America'',''New Hampshire'',''R001'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A03'',''United States of America'',''California'',''R002'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A04'',''United States of America'',''Oregon'',''R002'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A05'',''Singapore'',''North East Community'',''R003'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A06'',''Malaysia'',''Johor'',''R003'')';


END IF;

select * from address;

--CUSTOMER


SELECT count(*) into nCount FROM user_tables where table_name = 'CUSTOMER';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('CUSTOMER TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE CUSTOMER(
    CUST_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY  PRIMARY KEY,
    CUST_NAME VARCHAR(20) NOT NULL,
    CUST_CONTACT NUMBER(10) NOT NULL,
    CUST_EMAIL VARCHAR(50) NOT NULL,
    CUST_ACCOUNTNO VARCHAR(20) NOT NULL,
    CONSTRAINT ADDR_CODE
    ADDR VARCHAR(10) REFERENCES ADDRESS(ADDR_CODE),
    CUST_BUYINGPOWER NUMBER(10) NOT NULL,
    CUST_USERNAME VARCHAR(10) NOT NULL,
    CUST_PASSWORD VARCHAR(20) NOT NULL,
    CHECK (CUST_EMAIL LIKE ''%@%com%''))';
    
   INSERT INTO CUSTOMER VALUES(5,'Annie',1479101,'annie@gmail.com','10290671','A01',1000,'annie','annie123');
   INSERT INTO CUSTOMER VALUES(6,'Mark',1477701,'mark@gmail.com','102989371','A03',900,'Mark','mark123');
   INSERT INTO CUSTOMER VALUES(7,'Ed',293829,'ed@gmail.com','10290981','A05',10000,'ed','eddie129');
   INSERT INTO CUSTOMER VALUES(8,'Harry',1098701,'harry@gmail.com','09870671','A04',100000,'harry','harry123');
   INSERT INTO CUSTOMER VALUES(10,'Zac',1470987,'zac@gmail.com','12340671','A02',1870,'zac','zacc123');
   
   select * from customer;
   COMMIT;

  

   


   
END IF;



-- COMPANY TABLE--

SELECT count(*) into nCount FROM user_tables where table_name = 'COMPANY';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('COMPANY TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE '
        CREATE TABLE COMPANY(
        COMPANY_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY,
        COMPANY_NAME VARCHAR2(30) NOT NULL,
        COMPANY_CONTACT NUMBER(10) NOT NULL,
        PRIMARY KEY(COMPANY_ID))';
    
       
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(2,''INFOSYS'',8765435678);';

        SELECT * FROM company;
        INSERT INTO COMPANY VALUES(1,'GOOGLE',9999999999);
        INSERT INTO COMPANY VALUES(2,'META',8888888888);
        INSERT INTO COMPANY VALUES(3,'WALLMART',1111111111);
         INSERT INTO COMPANY VALUES(4,'SPACEX',7777777777);
         INSERT INTO COMPANY VALUES(5,'TESLA',4444444444);
          INSERT INTO COMPANY VALUES(6,'PAYPAL',2222222222);
          INSERT INTO COMPANY VALUES(7,'FIDELITY',6666666666);
          COMMIT;
        
END IF;


--- STOCK EXCHANGE--
SELECT count(*) into nCount 
FROM user_tables 
WHERE table_name='STOCKEXCHANGE';
IF(nCount>0)
THEN
    DBMS_OUTPUT.PUT_LINE('STOCKEXCHANGE TABLE ALREADY EXISTS');    
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE STOCKEXCHANGE(
    EXCHANGE_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EXCHANGE_NAME VARCHAR(30) NOT NULL,
    COMPANY_ID NUMBER(10) NOT NULL,
    CONSTRAINT COMPANY_ID
    FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(COMPANY_ID))';
    
    INSERT INTO STOCKEXCHANGE VALUES(1,'NASDAQ',1);
    INSERT INTO STOCKEXCHANGE VALUES(2,'NYSE',2);
    INSERT INTO STOCKEXCHANGE VALUES(3,'BSE',3);
    INSERT INTO STOCKEXCHANGE VALUES(4,'LONDON STOCK EXCHANGE',4);
    INSERT INTO STOCKEXCHANGE VALUES(5,'TOKYO STOCK EXCHANGE',5);
    
    COMMIT;

END IF;



--SECURITY EXCHANGE--
SELECT count(*) into nCount FROM user_tables where table_name = 'SECURITYEXCHANGE';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('SECURITYEXCHANGE TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE SECURITYEXCHANGE(
SECURITY_EXCH_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY,
SECURITY_ID NUMBER(10) PRIMARY KEY,
EXCHANGE_ID NUMBER(10) NOT NULL,
CONSTRAINT EXCHANGE_ID
FOREIGN KEY(EXCHANGE_ID) REFERENCES STOCKEXCHANGE(EXCHANGE_ID))';
END IF;


--STOCK INFO--
SELECT count(*) into nCount 
FROM user_tables 
WHERE table_name='STOCKINFO';
IF(nCount>0)
THEN
    DBMS_OUTPUT.PUT_LINE('STOCKINFO TABLE ALREADY EXISTS');    
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE STOCKINFO(
    STOCK_ID number(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AS_OF_DATE DATE UNIQUE,
    MARKET_VAL NUMBER(10),
    STOCK_QTY_AVAILABLE NUMBER(10),
    CONSTRAINT check_date CHECK (extract(day from AS_OF_DATE) = 1))';
    
    INSERT INTO STOCKINFO VALUES(6,TO_DATE('2005/05/06', 'yyyy/mm/dd'), 10000,50);
    INSERT INTO STOCKINFO VALUES(2,TO_DATE('2012/06/04', 'yyyy/mm/dd'), 6000,5);
    INSERT INTO STOCKINFO VALUES(3,TO_DATE('2019/12/09', 'yyyy/mm/dd '), 80000,60);
    INSERT INTO STOCKINFO VALUES(4,TO_DATE('2020/11/12', 'yyyy/mm/dd '), 900,80);
    INSERT INTO STOCKINFO VALUES(5,TO_DATE('2021/08/05', 'yyyy/mm/dd '), 300,5);
    
    COMMIT;

END IF;


--- SECURITY TYPE
SELECT count(*) into nCount FROM user_tables where table_name = 'SECURITYTYPE';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('SECURITYTYPE TABLE ALREADY EXISTS');
ELSE
        EXECUTE IMMEDIATE 'CREATE TABLE SECURITYTYPE(
      SECURITY_TYPE VARCHAR(20) NOT NULL,
     SECURITYTYPE_DESC VARCHAR(20) NOT NULL,
      PRIMARY KEY (SECURITY_TYPE)
    )';
    
    
END IF;



-- COMPANYSECURITY--
SELECT count(*) into nCount FROM user_tables where table_name = 'COMPANYSECURITY';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('COMPANYSECURITY TABLE ALREADY EXISTS');
ELSE
     EXECUTE IMMEDIATE 'CREATE TABLE COMPANYSECURITY(
    COMPANY_ID NUMBER(10) NOT NULL,
    SECURITY_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY ,
    STOCK_ID NUMBER(10) NOT NULL,
    REG_CD VARCHAR(10) ,
    SEC_TYPE VARCHAR(20),
    PRIMARY KEY(SECURITY_ID),
    CONSTRAINT COMPANY_ID
    FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(COMPANY_ID),
    CONSTRAINT STOCK_ID
    FOREIGN KEY(STOCK_ID) REFERENCES STOCKINFO(STOCK_ID),
    CONSTRAINT REG_CD
    FOREIGN KEY(REG_CD) REFERENCES REGIONCODES(REGCD),
    CONSTRAINT SEC_TYPE
    FOREIGN KEY(SEC_TYPE) REFERENCES SECURITYTYPE(SECURITY_TYPE))';
END IF;


--- CUSTOMERHOLDINGS---
SELECT count(*) into nCount FROM user_tables where table_name = 'CUSTOMERHOLDING';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('CUSTOMERHOLDING TABLE ALREADY EXISTS');
ELSE
     EXECUTE IMMEDIATE 'CREATE TABLE CUSTOMERHOLDING(
    HOLDINGID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY  PRIMARY KEY,
    CONSTRAINT SECURITY_ID
    SECURITYID  NUMBER(10)  REFERENCES COMPANYSECURITY(SECURITY_ID) NOT NULL,
    QTY	VARCHAR(30)	UNIQUE  NOT NULL,
    CONSTRAINT CUST_ID
    CUSTOMERID	NUMBER(10)	 REFERENCES CUSTOMER(CUST_ID) NOT NULL,
    COMPANYID	NUMBER	NOT NULL,
    asofdate  DATE )';
END IF;

SELECT count(*) into nCount 
FROM user_tables 
WHERE table_name='TRANSACTION';
IF(nCount>0)
THEN
    DBMS_OUTPUT.PUT_LINE('TRANSACTION TABLE ALREADY EXISTS');    
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE TRANSACTION(
      TXN_ID NUMBER(10)  GENERATED BY DEFAULT AS IDENTITY ,
      TXN_TYPE VARCHAR(30) NOT NULL,
      CUSTOMER_ID NUMBER(10) NOT NULL,
      STOCK_ID NUMBER(10) NOT NULL,
      QTY NUMBER(10) NOT NULL,
      PRICE NUMBER(10),
      TXN_DATE DATE,
      TXN_TIME TIMESTAMP,
      PRIMARY KEY(TXN_ID),
      CONSTRAINT CUST_IDTRANSACTION
      FOREIGN KEY(CUSTOMER_ID)REFERENCES CUSTOMER(CUST_ID),
      CONSTRAINT STOCK_IDTRANSACTION
      FOREIGN KEY(STOCK_ID) REFERENCES STOCKINFO(STOCK_ID))';
END IF;
END;